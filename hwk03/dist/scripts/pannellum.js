window.libpannellum=function(b,f,i){var j=Math.atan,n=Math.tan,o=Math.min,p=Math.max,q=Math.cos,r=Math.sin,v=Math.abs,w=Math.PI,y=Math.atan2,z=Math.asin,A=Math.sqrt;function a(e){var K=Math.pow,L=Math.acos;function t(b,a){return 1==b.level&&1!=a.level?-1:1==a.level&&1!=b.level?1:a.timestamp-b.timestamp}function d(b,a){return b.level==a.level?b.diff-a.diff:b.level-a.level}function E(b,a,d,c,e,f){this.vertices=b,this.side=a,this.level=d,this.x=c,this.y=e,this.path=f.replace("%s",a).replace("%l",d).replace("%x",c).replace("%y",e)}function G(b,a,c,f,g){var j,i=Math.ceil,l=a.vertices;j=J(b,l.slice(0,3));var m=J(b,l.slice(3,6)),n=J(b,l.slice(6,9)),l=J(b,l.slice(9,12)),o=j[0]+m[0]+n[0]+l[0];if(-4==o||4==o?j=!1:(o=j[1]+m[1]+n[1]+l[1],j=-4!=o&&4!=o&&4!=j[2]+m[2]+n[2]+l[2]),j){for(j=a.vertices,m=j[0]+j[3]+j[6]+j[9],n=j[1]+j[4]+j[7]+j[10],l=j[2]+j[5]+j[8]+j[11],o=A(m*m+n*n+l*l),l=z(l/o),m=y(n,m)-f,m+=m>w?-2*w:m<-w?2*w:0,m=v(m),a.diff=L(r(c)*r(l)+q(c)*q(l)*q(m)),m=!1,n=0;n<N.nodeCache.length;n++)if(N.nodeCache[n].path==a.path){m=!0,N.nodeCache[n].timestamp=N.nodeCacheTimestamp++,N.nodeCache[n].diff=a.diff,N.currentNodes.push(N.nodeCache[n]);break}if(m||(a.timestamp=N.nodeCacheTimestamp++,N.currentNodes.push(a),N.nodeCache.push(a)),a.level<N.level){var l=Z.cubeResolution*K(2,a.level-Z.maxLevel),m=i(l*Z.invTileResolution)-1,n=2*(l%Z.tileResolution),p=2*l%Z.tileResolution;0===p&&(p=Z.tileResolution),0===n&&(n=2*Z.tileResolution),o=.5,(a.x==m||a.y==m)&&(o=1-Z.tileResolution/(Z.tileResolution+p));var C=1-o,l=[],F=o,H=o,M=o,O=C,P=C,Q=C;for(p<Z.tileResolution&&(a.x==m&&a.y!=m?(P=H=.5,"d"==a.side||"u"==a.side)&&(Q=M=.5):a.x!=m&&a.y==m&&(O=F=.5,"l"==a.side||"r"==a.side)&&(Q=M=.5)),n<=Z.tileResolution&&(a.x==m&&(F=0,O=1,"l"==a.side||"r"==a.side)&&(M=0,Q=1),a.y==m&&(H=0,P=1,"d"==a.side||"u"==a.side)&&(M=0,Q=1)),p=[j[0],j[1],j[2],j[0]*F+j[3]*O,j[1]*o+j[4]*C,j[2]*M+j[5]*Q,j[0]*F+j[6]*O,j[1]*H+j[7]*P,j[2]*M+j[8]*Q,j[0]*o+j[9]*C,j[1]*H+j[10]*P,j[2]*M+j[11]*Q],p=new E(p,a.side,a.level+1,2*a.x,2*a.y,Z.fullpath),l.push(p),a.x==m&&n<=Z.tileResolution||(p=[j[0]*F+j[3]*O,j[1]*o+j[4]*C,j[2]*M+j[5]*Q,j[3],j[4],j[5],j[3]*o+j[6]*C,j[4]*H+j[7]*P,j[5]*M+j[8]*Q,j[0]*F+j[6]*O,j[1]*H+j[7]*P,j[2]*M+j[8]*Q],p=new E(p,a.side,a.level+1,2*a.x+1,2*a.y,Z.fullpath),l.push(p)),a.x==m&&n<=Z.tileResolution||a.y==m&&n<=Z.tileResolution||(p=[j[0]*F+j[6]*O,j[1]*H+j[7]*P,j[2]*M+j[8]*Q,j[3]*o+j[6]*C,j[4]*H+j[7]*P,j[5]*M+j[8]*Q,j[6],j[7],j[8],j[9]*F+j[6]*O,j[10]*o+j[7]*C,j[11]*M+j[8]*Q],p=new E(p,a.side,a.level+1,2*a.x+1,2*a.y+1,Z.fullpath),l.push(p)),a.y==m&&n<=Z.tileResolution||(p=[j[0]*o+j[9]*C,j[1]*H+j[10]*P,j[2]*M+j[11]*Q,j[0]*F+j[6]*O,j[1]*H+j[7]*P,j[2]*M+j[8]*Q,j[9]*F+j[6]*O,j[10]*o+j[7]*C,j[11]*M+j[8]*Q,j[9],j[10],j[11]],p=new E(p,a.side,a.level+1,2*a.x,2*a.y+1,Z.fullpath),l.push(p)),a=0;a<l.length;a++)G(b,l[a],c,f,g)}}}function h(){return[-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,1,1,-1,1,1,1,1,-1,1,1,-1,-1]}function x(b,a,d){var c=r(a);return a=q(a),"x"==d?[b[0],a*b[1]+c*b[2],a*b[2]-c*b[1],b[3],a*b[4]+c*b[5],a*b[5]-c*b[4],b[6],a*b[7]+c*b[8],a*b[8]-c*b[7]]:"y"==d?[a*b[0]-c*b[2],b[1],a*b[2]+c*b[0],a*b[3]-c*b[5],b[4],a*b[5]+c*b[3],a*b[6]-c*b[8],b[7],a*b[8]+c*b[6]]:"z"==d?[a*b[0]+c*b[1],a*b[1]-c*b[0],b[2],a*b[3]+c*b[4],a*b[4]-c*b[3],b[5],a*b[6]+c*b[7],a*b[7]-c*b[6],b[8]]:void 0}function H(b){return[b[0],b[4],b[8],b[12],b[1],b[5],b[9],b[13],b[2],b[6],b[10],b[14],b[3],b[7],b[11],b[15]]}function l(b){S(b,b.path+"."+Z.extension,function(a,d){b.texture=a,b.textureLoaded=d?2:1},ha.crossOrigin)}function J(b,a){var d=[b[0]*a[0]+b[1]*a[1]+b[2]*a[2],b[4]*a[0]+b[5]*a[1]+b[6]*a[2],b[11]+b[8]*a[0]+b[9]*a[1]+b[10]*a[2],1/(b[12]*a[0]+b[13]*a[1]+b[14]*a[2])],e=d[0]*d[3],f=d[1]*d[3],d=d[2]*d[3],g=[0,0,0];return-1>e&&(g[0]=-1),1<e&&(g[0]=1),-1>f&&(g[1]=-1),1<f&&(g[1]=1),(-1>d||1<d)&&(g[2]=1),g}function I(){var a=Math.round;console.log("Reducing canvas size due to error 1286!"),M.width=a(M.width/2),M.height=a(M.height/2)}var M=f.createElement("canvas");M.style.width=M.style.height="100%",e.appendChild(M);var N,O,P,Q,u,T,W,X,Z,_,aa,ba,da,ea,fa,ha;this.init=function(a,b,c,j,m,n,o,d){function q(f){if(x){var g=4*(f*f),e=new Uint8ClampedArray(g),h=d.backgroundColor?d.backgroundColor:[0,0,0];h[0]*=255,h[1]*=255,h[2]*=255;for(var c=0;c<g;c++)e[c++]=h[0],e[c++]=h[1],e[c++]=h[2];for(f=new ImageData(e,f,f),r=0;6>r;r++)0==Z[r].width&&(Z[r]=f)}}if(b===i&&(b="equirectangular"),"equirectangular"!=b&&"cubemap"!=b&&"multires"!=b)throw console.log("Error: invalid image type specified!"),{type:"config error"};if(_=b,Z=a,aa=c,ha=d||{},N){if(P&&(O.detachShader(N,P),O.deleteShader(P)),Q&&(O.detachShader(N,Q),O.deleteShader(Q)),O.bindBuffer(O.ARRAY_BUFFER,null),O.bindBuffer(O.ELEMENT_ARRAY_BUFFER,null),N.texture&&O.deleteTexture(N.texture),N.nodeCache)for(a=0;a<N.nodeCache.length;a++)O.deleteTexture(N.nodeCache[a].texture);O.deleteProgram(N),N=i}X=i;var r,v,x=!1;if("cubemap"==_)for(r=0;6>r;r++)0<Z[r].width?(v===i&&(v=Z[r].width),v!=Z[r].width&&console.log("Cube faces have inconsistent widths: "+v+" vs. "+Z[r].width)):x=!0;if("cubemap"==_&&0!=(v&v-1)&&(navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 8_/)||navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 9_/)||navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 10_/)||navigator.userAgent.match(/Trident.*rv[ :]*11\./))||(O||(O=M.getContext("experimental-webgl",{alpha:!1,depth:!1})),O&&1286==O.getError()&&I()),!O&&("multires"==_&&Z.hasOwnProperty("fallbackPath")||"cubemap"==_)&&("WebkitAppearance"in f.documentElement.style||navigator.userAgent.match(/Trident.*rv[ :]*11\./)||-1!==navigator.appVersion.indexOf("MSIE 10"))){T&&e.removeChild(T),T=f.createElement("div"),T.className="pnlm-world",j=Z.basePath?Z.basePath+Z.fallbackPath:Z.fallbackPath;var z=["f","r","b","l","u","d"],A=0;m=function(){var g=f.createElement("canvas");g.className="pnlm-face pnlm-"+z[this.side]+"face",T.appendChild(g);var a=g.getContext("2d");g.style.width=this.width+4+"px",g.style.height=this.height+4+"px",g.width=this.width+4,g.height=this.height+4,a.drawImage(this,2,2);var e,i,j=a.getImageData(0,0,g.width,g.height),h=j.data;for(e=2;e<g.width-2;e++)for(i=0;4>i;i++)h[4*(e+g.width)+i]=h[4*(e+2*g.width)+i],h[4*(e+g.width*(g.height-2))+i]=h[4*(e+g.width*(g.height-3))+i];for(e=2;e<g.height-2;e++)for(i=0;4>i;i++)h[4*(e*g.width+1)+i]=h[4*(e*g.width+2)+i],h[4*((e+1)*g.width-2)+i]=h[4*((e+1)*g.width-3)+i];for(i=0;4>i;i++)h[4*(g.width+1)+i]=h[4*(2*g.width+2)+i],h[4*(2*g.width-2)+i]=h[4*(3*g.width-3)+i],h[4*(g.width*(g.height-2)+1)+i]=h[4*(g.width*(g.height-3)+2)+i],h[4*(g.width*(g.height-1)-2)+i]=h[4*(g.width*(g.height-2)-3)+i];for(e=1;e<g.width-1;e++)for(i=0;4>i;i++)h[4*e+i]=h[4*(e+g.width)+i],h[4*(e+g.width*(g.height-1))+i]=h[4*(e+g.width*(g.height-2))+i];for(e=1;e<g.height-1;e++)for(i=0;4>i;i++)h[4*(e*g.width)+i]=h[4*(e*g.width+1)+i],h[4*((e+1)*g.width-1)+i]=h[4*((e+1)*g.width-2)+i];for(i=0;4>i;i++)h[i]=h[4*(g.width+1)+i],h[4*(g.width-1)+i]=h[4*(2*g.width-2)+i],h[4*(g.width*(g.height-1))+i]=h[4*(g.width*(g.height-2)+1)+i],h[4*(g.width*g.height-1)+i]=h[4*(g.width*(g.height-1)-2)+i];a.putImageData(j,0,0),F.call(this)};var F=function(){0<this.width?(u===i&&(u=this.width),u!=this.width&&console.log("Fallback faces have inconsistent widths: "+u+" vs. "+this.width)):x=!0,A++,6==A&&(u=this.width,e.appendChild(T),o())},x=!1;for(r=0;6>r;r++)n=new Image,n.crossOrigin=ha.crossOrigin?ha.crossOrigin:"anonymous",n.side=r,n.onload=m,n.onerror=F,n.src="multires"==_?j.replace("%s",z[r])+"."+Z.extension:Z[r].src;q(u)}else{if(!O)throw console.log("Error: no WebGL support detected!"),{type:"no webgl"};for("cubemap"==_&&q(v),Z.fullpath=Z.basePath?Z.basePath+Z.path:Z.path,Z.invTileResolution=1/Z.tileResolution,a=h(),W=[],r=0;6>r;r++)W[r]=a.slice(12*r,12*r+12),a=h();if(a=0,"equirectangular"==_){if(a=O.getParameter(O.MAX_TEXTURE_SIZE),p(Z.width/2,Z.height)>a)throw console.log("Error: The image is too big; it's "+Z.width+"px wide, but this device's maximum supported size is "+2*a+"px."),{type:"webgl size error",width:Z.width,maxWidth:2*a};}else if("cubemap"==_&&v>O.getParameter(O.MAX_CUBE_MAP_TEXTURE_SIZE))throw console.log("Error: The image is too big; it's "+v+"px wide, but this device's maximum supported size is "+a+"px."),{type:"webgl size error",width:v,maxWidth:a};if(d===i||d.horizonPitch===i&&d.horizonRoll===i||(X=[d.horizonPitch==i?0:d.horizonPitch,d.horizonRoll==i?0:d.horizonRoll]),v=O.TEXTURE_2D,O.viewport(0,0,O.drawingBufferWidth,O.drawingBufferHeight),O.getShaderPrecisionFormat&&(b=O.getShaderPrecisionFormat(O.FRAGMENT_SHADER,O.HIGH_FLOAT))&&1>b.precision&&(k=k.replace("highp","mediump")),P=O.createShader(O.VERTEX_SHADER),b=B,"multires"==_&&(b=g),O.shaderSource(P,b),O.compileShader(P),Q=O.createShader(O.FRAGMENT_SHADER),b=C,"cubemap"==_?(v=O.TEXTURE_CUBE_MAP,b=s):"multires"==_&&(b=D),O.shaderSource(Q,b),O.compileShader(Q),N=O.createProgram(),O.attachShader(N,P),O.attachShader(N,Q),O.linkProgram(N),O.getShaderParameter(P,O.COMPILE_STATUS)||console.log(O.getShaderInfoLog(P)),O.getShaderParameter(Q,O.COMPILE_STATUS)||console.log(O.getShaderInfoLog(Q)),O.getProgramParameter(N,O.LINK_STATUS)||console.log(O.getProgramInfoLog(N)),O.useProgram(N),N.drawInProgress=!1,b=d.backgroundColor?d.backgroundColor:[0,0,0],O.clearColor(b[0],b[1],b[2],1),O.clear(O.COLOR_BUFFER_BIT),N.texCoordLocation=O.getAttribLocation(N,"a_texCoord"),O.enableVertexAttribArray(N.texCoordLocation),"multires"==_?(N.vertPosLocation=O.getAttribLocation(N,"a_vertCoord"),O.enableVertexAttribArray(N.vertPosLocation),da||(da=O.createBuffer()),ea||(ea=O.createBuffer()),fa||(fa=O.createBuffer()),O.bindBuffer(O.ARRAY_BUFFER,ea),O.bufferData(O.ARRAY_BUFFER,new Float32Array([0,0,1,0,1,1,0,1]),O.STATIC_DRAW),O.bindBuffer(O.ELEMENT_ARRAY_BUFFER,fa),O.bufferData(O.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,0,2,3]),O.STATIC_DRAW),N.perspUniform=O.getUniformLocation(N,"u_perspMatrix"),N.cubeUniform=O.getUniformLocation(N,"u_cubeMatrix"),N.level=-1,N.currentNodes=[],N.nodeCache=[],N.nodeCacheTimestamp=0):(ba||(ba=O.createBuffer()),O.bindBuffer(O.ARRAY_BUFFER,ba),O.bufferData(O.ARRAY_BUFFER,new Float32Array([-1,1,1,1,1,-1,-1,1,1,-1,-1,-1]),O.STATIC_DRAW),O.vertexAttribPointer(N.texCoordLocation,2,O.FLOAT,!1,0,0),N.aspectRatio=O.getUniformLocation(N,"u_aspectRatio"),O.uniform1f(N.aspectRatio,O.drawingBufferWidth/O.drawingBufferHeight),N.psi=O.getUniformLocation(N,"u_psi"),N.theta=O.getUniformLocation(N,"u_theta"),N.f=O.getUniformLocation(N,"u_f"),N.h=O.getUniformLocation(N,"u_h"),N.v=O.getUniformLocation(N,"u_v"),N.vo=O.getUniformLocation(N,"u_vo"),N.rot=O.getUniformLocation(N,"u_rot"),O.uniform1f(N.h,j/(2*w)),O.uniform1f(N.v,m/w),O.uniform1f(N.vo,2*(n/w)),"equirectangular"==_&&(N.backgroundColor=O.getUniformLocation(N,"u_backgroundColor"),O.uniform4fv(N.backgroundColor,b.concat([1]))),N.texture=O.createTexture(),O.bindTexture(v,N.texture),"cubemap"==_?(O.texImage2D(O.TEXTURE_CUBE_MAP_POSITIVE_X,0,O.RGB,O.RGB,O.UNSIGNED_BYTE,Z[1]),O.texImage2D(O.TEXTURE_CUBE_MAP_NEGATIVE_X,0,O.RGB,O.RGB,O.UNSIGNED_BYTE,Z[3]),O.texImage2D(O.TEXTURE_CUBE_MAP_POSITIVE_Y,0,O.RGB,O.RGB,O.UNSIGNED_BYTE,Z[4]),O.texImage2D(O.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,O.RGB,O.RGB,O.UNSIGNED_BYTE,Z[5]),O.texImage2D(O.TEXTURE_CUBE_MAP_POSITIVE_Z,0,O.RGB,O.RGB,O.UNSIGNED_BYTE,Z[0]),O.texImage2D(O.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,O.RGB,O.RGB,O.UNSIGNED_BYTE,Z[2])):Z.width<=a?(O.uniform1i(O.getUniformLocation(N,"u_splitImage"),0),O.texImage2D(v,0,O.RGB,O.RGB,O.UNSIGNED_BYTE,Z)):(O.uniform1i(O.getUniformLocation(N,"u_splitImage"),1),j=f.createElement("canvas"),j.width=Z.width/2,j.height=Z.height,j=j.getContext("2d"),j.drawImage(Z,0,0),m=j.getImageData(0,0,Z.width/2,Z.height),O.texImage2D(v,0,O.RGB,O.RGB,O.UNSIGNED_BYTE,m),N.texture2=O.createTexture(),O.activeTexture(O.TEXTURE1),O.bindTexture(v,N.texture2),O.uniform1i(O.getUniformLocation(N,"u_image1"),1),j.drawImage(Z,-Z.width/2,0),m=j.getImageData(0,0,Z.width/2,Z.height),O.texImage2D(v,0,O.RGB,O.RGB,O.UNSIGNED_BYTE,m),O.texParameteri(v,O.TEXTURE_WRAP_S,O.CLAMP_TO_EDGE),O.texParameteri(v,O.TEXTURE_WRAP_T,O.CLAMP_TO_EDGE),O.texParameteri(v,O.TEXTURE_MIN_FILTER,O.LINEAR),O.texParameteri(v,O.TEXTURE_MAG_FILTER,O.LINEAR),O.activeTexture(O.TEXTURE0)),O.texParameteri(v,O.TEXTURE_WRAP_S,O.CLAMP_TO_EDGE),O.texParameteri(v,O.TEXTURE_WRAP_T,O.CLAMP_TO_EDGE),O.texParameteri(v,O.TEXTURE_MIN_FILTER,O.LINEAR),O.texParameteri(v,O.TEXTURE_MAG_FILTER,O.LINEAR)),j=O.getError(),0!==j)throw console.log("Error: Something went wrong with WebGL!",j),{type:"webgl error"};o()}},this.destroy=function(){if(e!==i&&(M!==i&&e.contains(M)&&e.removeChild(M),T!==i&&e.contains(T)&&e.removeChild(T)),O){var a=O.getExtension("WEBGL_lose_context");a&&a.loseContext()}},this.resize=function(){var a=b.devicePixelRatio||1;M.width=M.clientWidth*a,M.height=M.clientHeight*a,O&&(1286==O.getError()&&I(),O.viewport(0,0,O.drawingBufferWidth,O.drawingBufferHeight),"multires"!=_&&O.uniform1f(N.aspectRatio,M.clientWidth/M.clientHeight))},this.resize(),this.setPose=function(b,a){X=[b,a]},this.render=function(a,b,c,f){var m,v=0;if(f===i&&(f={}),f.roll&&(v=f.roll),X!==i){m=X[0];var B=X[1],C=a,D=b,F=q(B)*r(a)*r(m)+q(a)*(q(m)*q(b)+r(B)*r(m)*r(b)),I=-r(a)*r(B)+q(a)*q(B)*r(b);a=q(B)*q(m)*r(a)+q(a)*(-q(b)*r(m)+q(m)*r(B)*r(b)),a=z(p(o(a,1),-1)),b=y(I,F),m=[q(C)*(r(B)*r(m)*q(D)-q(m)*r(D)),q(C)*q(B)*q(D),q(C)*(q(m)*r(B)*q(D)+r(D)*r(m))],B=[-q(a)*r(b),q(a)*q(b)],B=L(p(o((m[0]*B[0]+m[1]*B[1])/(A(m[0]*m[0]+m[1]*m[1]+m[2]*m[2])*A(B[0]*B[0]+B[1]*B[1])),1),-1)),0>m[2]&&(B=2*w-B),v+=B}if(O||"multires"!=_&&"cubemap"!=_){if("multires"!=_)c=2*j(n(.5*c)/(O.drawingBufferWidth/O.drawingBufferHeight)),c=1/n(.5*c),O.uniform1f(N.psi,b),O.uniform1f(N.theta,a),O.uniform1f(N.rot,v),O.uniform1f(N.f,c),!0===aa&&"equirectangular"==_&&(O.bindTexture(O.TEXTURE_2D,N.texture),O.texImage2D(O.TEXTURE_2D,0,O.RGB,O.RGB,O.UNSIGNED_BYTE,Z)),O.drawArrays(O.TRIANGLES,0,6);else{for(m=O.drawingBufferWidth/O.drawingBufferHeight,B=2*j(n(c/2)*O.drawingBufferHeight/O.drawingBufferWidth),B=1/n(B/2),m=[B/m,0,0,0,0,B,0,0,0,0,100.1/-99.9,20/-99.9,0,0,-1,0],B=1;B<Z.maxLevel&&O.drawingBufferWidth>.707*(Z.tileResolution*K(2,B-1)*n(c/2));)B++;if(N.level=B,B=[1,0,0,0,1,0,0,0,1],B=x(B,-v,"z"),B=x(B,-a,"x"),B=x(B,b,"y"),B=[B[0],B[1],B[2],0,B[3],B[4],B[5],0,B[6],B[7],B[8],0,0,0,0,1],O.uniformMatrix4fv(N.perspUniform,!1,new Float32Array(H(m))),O.uniformMatrix4fv(N.cubeUniform,!1,new Float32Array(H(B))),v=[m[0]*B[0],m[0]*B[1],m[0]*B[2],0,m[5]*B[4],m[5]*B[5],m[5]*B[6],0,m[10]*B[8],m[10]*B[9],m[10]*B[10],m[11],-B[8],-B[9],-B[10],0],N.nodeCache.sort(t),200<N.nodeCache.length&&N.nodeCache.length>N.currentNodes.length+50)for(m=N.nodeCache.splice(200,N.nodeCache.length-200),B=0;B<m.length;B++)O.deleteTexture(m[B].texture);for(N.currentNodes=[],B=["f","b","u","d","l","r"],m=0;6>m;m++)C=new E(W[m],B[m],1,0,0,Z.fullpath),G(v,C,a,b,c);for(N.currentNodes.sort(d),a=ia.length-1;0<=a;a--)-1===N.currentNodes.indexOf(ia[a].node)&&(ia[a].node.textureLoad=!1,ia.splice(a,1));if(0===ia.length)for(a=0;a<N.currentNodes.length;a++)if(b=N.currentNodes[a],!b.texture&&!b.textureLoad){b.textureLoad=!0,setTimeout(l,0,b);break}if(!N.drawInProgress){for(N.drawInProgress=!0,O.clear(O.COLOR_BUFFER_BIT),a=0;a<N.currentNodes.length;a++)1<N.currentNodes[a].textureLoaded&&(O.bindBuffer(O.ARRAY_BUFFER,da),O.bufferData(O.ARRAY_BUFFER,new Float32Array(N.currentNodes[a].vertices),O.STATIC_DRAW),O.vertexAttribPointer(N.vertPosLocation,3,O.FLOAT,!1,0,0),O.bindBuffer(O.ARRAY_BUFFER,ea),O.vertexAttribPointer(N.texCoordLocation,2,O.FLOAT,!1,0,0),O.bindTexture(O.TEXTURE_2D,N.currentNodes[a].texture),O.drawElements(O.TRIANGLES,6,O.UNSIGNED_SHORT,0));N.drawInProgress=!1}}if(f.returnImage!==i)return M.toDataURL("image/png")}else for(m=u/2,f={f:"translate3d(-"+(m+2)+"px, -"+(m+2)+"px, -"+m+"px)",b:"translate3d("+(m+2)+"px, -"+(m+2)+"px, "+m+"px) rotateX(180deg) rotateZ(180deg)",u:"translate3d(-"+(m+2)+"px, -"+m+"px, "+(m+2)+"px) rotateX(270deg)",d:"translate3d(-"+(m+2)+"px, "+m+"px, -"+(m+2)+"px) rotateX(90deg)",l:"translate3d(-"+m+"px, -"+(m+2)+"px, "+(m+2)+"px) rotateX(180deg) rotateY(90deg) rotateZ(180deg)",r:"translate3d("+m+"px, -"+(m+2)+"px, -"+(m+2)+"px) rotateY(270deg)"},c=1/n(c/2),c=c*M.clientWidth/2+"px",b="perspective("+c+") translateZ("+c+") rotateX("+a+"rad) rotateY("+b+"rad) ",c=Object.keys(f),a=0;6>a;a++)(v=T.querySelector(".pnlm-"+c[a]+"face"))&&(v.style.webkitTransform=b+f[c[a]],v.style.transform=b+f[c[a]])},this.isLoading=function(){if(O&&"multires"==_)for(var a=0;a<N.currentNodes.length;a++)if(!N.currentNodes[a].textureLoaded)return!0;return!1},this.getCanvas=function(){return M};var ia=[],S=function(){function a(){var a=this;this.texture=this.callback=null,this.image=new Image,this.image.crossOrigin=f?f:"anonymous";var b=function(){if(0<a.image.width&&0<a.image.height){var b=a.image;O.bindTexture(O.TEXTURE_2D,a.texture),O.texImage2D(O.TEXTURE_2D,0,O.RGB,O.RGB,O.UNSIGNED_BYTE,b),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_MAG_FILTER,O.LINEAR),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_MIN_FILTER,O.LINEAR),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_WRAP_S,O.CLAMP_TO_EDGE),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_WRAP_T,O.CLAMP_TO_EDGE),O.bindTexture(O.TEXTURE_2D,null),a.callback(a.texture,!0)}else a.callback(a.texture,!1);ia.length?(b=ia.shift(),a.loadTexture(b.src,b.texture,b.callback)):i[e++]=a};this.image.addEventListener("load",b),this.image.addEventListener("error",b)}function b(b,a,c,d){this.node=b,this.src=a,this.texture=c,this.callback=d}var f,e=4,i={};a.prototype.loadTexture=function(b,a,c){this.texture=a,this.callback=c,this.image.src=b};for(var c=0;c<e;c++)i[c]=new a;return function(a,c,d,g){return f=g,g=O.createTexture(),e?i[--e].loadTexture(c,g,d):ia.push(new b(a,c,g,d)),g}}()}var B="attribute vec2 a_texCoord;varying vec2 v_texCoord;void main() {gl_Position = vec4(a_texCoord, 0.0, 1.0);v_texCoord = a_texCoord;}",g="attribute vec3 a_vertCoord;attribute vec2 a_texCoord;uniform mat4 u_cubeMatrix;uniform mat4 u_perspMatrix;varying mediump vec2 v_texCoord;void main(void) {gl_Position = u_perspMatrix * u_cubeMatrix * vec4(a_vertCoord, 1.0);v_texCoord = a_texCoord;}",k="precision highp float;\nuniform float u_aspectRatio;\nuniform float u_psi;\nuniform float u_theta;\nuniform float u_f;\nuniform float u_h;\nuniform float u_v;\nuniform float u_vo;\nuniform float u_rot;\nconst float PI = 3.14159265358979323846264;\nuniform sampler2D u_image0;\nuniform sampler2D u_image1;\nuniform bool u_splitImage;\nuniform samplerCube u_imageCube;\nvarying vec2 v_texCoord;\nuniform vec4 u_backgroundColor;\nvoid main() {\nfloat x = v_texCoord.x * u_aspectRatio;\nfloat y = v_texCoord.y;\nfloat sinrot = sin(u_rot);\nfloat cosrot = cos(u_rot);\nfloat rot_x = x * cosrot - y * sinrot;\nfloat rot_y = x * sinrot + y * cosrot;\nfloat sintheta = sin(u_theta);\nfloat costheta = cos(u_theta);\nfloat a = u_f * costheta - rot_y * sintheta;\nfloat root = sqrt(rot_x * rot_x + a * a);\nfloat lambda = atan(rot_x / root, a / root) + u_psi;\nfloat phi = atan((rot_y * costheta + u_f * sintheta) / root);",s=k+"float cosphi = cos(phi);\ngl_FragColor = textureCube(u_imageCube, vec3(cosphi*sin(lambda), sin(phi), cosphi*cos(lambda)));\n}",C=k+"lambda = mod(lambda + PI, PI * 2.0) - PI;\nvec2 coord = vec2(lambda / PI, phi / (PI / 2.0));\nif(coord.x < -u_h || coord.x > u_h || coord.y < -u_v + u_vo || coord.y > u_v + u_vo)\ngl_FragColor = u_backgroundColor;\nelse {\nif(u_splitImage) {\nif(coord.x < 0.0)\ngl_FragColor = texture2D(u_image0, vec2((coord.x + u_h) / u_h, (-coord.y + u_v + u_vo) / (u_v * 2.0)));\nelse\ngl_FragColor = texture2D(u_image1, vec2((coord.x + u_h) / u_h - 1.0, (-coord.y + u_v + u_vo) / (u_v * 2.0)));\n} else {\ngl_FragColor = texture2D(u_image0, vec2((coord.x + u_h) / (u_h * 2.0), (-coord.y + u_v + u_vo) / (u_v * 2.0)));\n}\n}\n}",D="varying mediump vec2 v_texCoord;uniform sampler2D u_sampler;void main(void) {gl_FragColor = texture2D(u_sampler, v_texCoord);}";return{renderer:function(b,c,d,e){return new a(b,c,d,e)}}}(window,document),window.pannellum=function(i,j,o){var h=Math.atan,q=Math.tan,s=Math.min,t=Math.max,u=Math.cos,v=Math.sin,y=Math.abs,z=Math.PI,A=Math.atan2,B=Math.sqrt;function a(g,n){function f(){var b=j.createElement("div");if(b.innerHTML="<!--[if lte IE 9]><i></i><![endif]-->",1==b.getElementsByTagName("i").length)_();else{ib=bb.hfov,jb=bb.pitch;var g;if("cubemap"==bb.type){for(fb=[],b=0;6>b;b++)fb.push(new Image),fb[b].crossOrigin=bb.crossOrigin;fa.load.lbox.style.display="block",fa.load.lbar.style.display="none"}else if("multires"==bb.type)b=JSON.parse(JSON.stringify(bb.multiRes)),bb.basePath&&bb.multiRes.basePath&&!/^(?:[a-z]+:)?\/\//i.test(bb.multiRes.basePath)?b.basePath=bb.basePath+bb.multiRes.basePath:bb.multiRes.basePath?b.basePath=bb.multiRes.basePath:bb.basePath&&(b.basePath=bb.basePath),fb=b;else if(!0===bb.dynamic)fb=bb.panorama;else{if(bb.panorama===o)return void _(bb.strings.noPanoramaError);fb=new Image}if("cubemap"==bb.type)for(var h=6,l=function(){h--,0===h&&p()},c=function(b){var a=j.createElement("a");a.href=b.target.src,a.textContent=a.href,_(bb.strings.fileAccessError.replace("%s",a.outerHTML))},b=0;b<fb.length;b++)g=bb.cubeMap[b],"null"==g?(console.log("Will use background instead of missing cubemap face "+b),l()):(bb.basePath&&!k(g)&&(g=bb.basePath+g),fb[b].onload=l,fb[b].onerror=c,fb[b].src=D(g));else if("multires"==bb.type)p();else if(g="",bb.basePath&&(g=bb.basePath),!0!==bb.dynamic){g=k(bb.panorama)?bb.panorama:g+bb.panorama,fb.onload=function(){i.URL.revokeObjectURL(this.src),p()};var d=new XMLHttpRequest;d.onloadend=function(){if(200!=d.status){var b=j.createElement("a");b.href=g,b.textContent=b.href,_(bb.strings.fileAccessError.replace("%s",b.outerHTML))}E(this.response),fa.load.msg.innerHTML=""},d.onprogress=function(c){if(c.lengthComputable){fa.load.lbarFill.style.width=100*(c.loaded/c.total)+"%";var d,e;1E6<c.total?(d="MB",e=(c.loaded/1E6).toFixed(2),c=(c.total/1E6).toFixed(2)):1E3<c.total?(d="kB",e=(c.loaded/1E3).toFixed(1),c=(c.total/1E3).toFixed(1)):(d="B",e=c.loaded,c=c.total),fa.load.msg.innerHTML=e+" / "+c+" "+d}else fa.load.lbox.style.display="block",fa.load.lbar.style.display="none"};try{d.open("GET",g,!0)}catch(a){_(bb.strings.malformedURLError)}d.responseType="blob",d.setRequestHeader("Accept","image/*,*/*;q=0.9"),d.withCredentials="use-credentials"===bb.crossOrigin,d.send()}bb.draggable&&Va.classList.add("pnlm-grab"),Va.classList.remove("pnlm-grabbing"),Cb=!0===bb.dynamicUpdate,bb.dynamic&&Cb&&(fb=bb.panorama,p())}}function k(b){return /^(?:[a-z]+:)?\/\//i.test(b)||"/"==b[0]||"blob:"==b.slice(0,5)}function p(){cb||(cb=new libpannellum.renderer(J)),tb||(tb=!0,M.addEventListener("mousedown",Q,!1),j.addEventListener("mousemove",oa,!1),j.addEventListener("mouseup",pa,!1),bb.mouseZoom&&(Va.addEventListener("mousewheel",a,!1),Va.addEventListener("DOMMouseScroll",a,!1)),bb.doubleClickZoom&&M.addEventListener("dblclick",ja,!1),g.addEventListener("mozfullscreenchange",Ca,!1),g.addEventListener("webkitfullscreenchange",Ca,!1),g.addEventListener("msfullscreenchange",Ca,!1),g.addEventListener("fullscreenchange",Ca,!1),i.addEventListener("resize",m,!1),i.addEventListener("orientationchange",m,!1),bb.disableKeyboardCtrl||(g.addEventListener("keydown",U,!1),g.addEventListener("keyup",$,!1),g.addEventListener("blur",V,!1)),j.addEventListener("mouseleave",pa,!1),""===j.documentElement.style.pointerAction&&""===j.documentElement.style.touchAction?(M.addEventListener("pointerdown",ta,!1),M.addEventListener("pointermove",ua,!1),M.addEventListener("pointerup",c,!1),M.addEventListener("pointerleave",c,!1)):(M.addEventListener("touchstart",ma,!1),M.addEventListener("touchmove",qa,!1),M.addEventListener("touchend",la,!1)),i.navigator.pointerEnabled&&(g.style.touchAction="none")),na(),La(bb.hfov),setTimeout(function(){},500)}function E(b){var a=new FileReader;a.addEventListener("loadend",function(){var f=a.result;if(navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 8_/)){var j=f.indexOf("\xFF\xC2");(0>j||65536<j)&&_(bb.strings.iOS8WebGLError)}if(j=f.indexOf("<x:xmpmeta"),-1<j&&!0!==bb.ignoreGPanoXMP){var p=f.substring(j,f.indexOf("</x:xmpmeta>")+12),d=function(c){var a;return 0<=p.indexOf(c+"=\"")?(a=p.substring(p.indexOf(c+"=\"")+c.length+2),a=a.substring(0,a.indexOf("\""))):0<=p.indexOf(c+">")&&(a=p.substring(p.indexOf(c+">")+c.length+1),a=a.substring(0,a.indexOf("<"))),a===o?null:+a},f=d("GPano:FullPanoWidthPixels"),j=d("GPano:CroppedAreaImageWidthPixels"),q=d("GPano:FullPanoHeightPixels"),g=d("GPano:CroppedAreaImageHeightPixels"),h=d("GPano:CroppedAreaTopPixels"),l=d("GPano:PoseHeadingDegrees"),k=d("GPano:PosePitchDegrees"),d=d("GPano:PoseRollDegrees");null!==f&&null!==j&&null!==q&&null!==g&&null!==h&&(0>Bb.indexOf("haov")&&(bb.haov=360*(j/f)),0>Bb.indexOf("vaov")&&(bb.vaov=180*(g/q)),0>Bb.indexOf("vOffset")&&(bb.vOffset=-180*((h+g/2)/q-.5)),null!==l&&0>Bb.indexOf("northOffset")&&(bb.northOffset=l,!1!==bb.compass&&(bb.compass=!0)),null!==k&&null!==d&&(0>Bb.indexOf("horizonPitch")&&(bb.horizonPitch=k),0>Bb.indexOf("horizonRoll")&&(bb.horizonRoll=d)))}fb.src=i.URL.createObjectURL(b)}),a.readAsBinaryString===o?a.readAsText(b):a.readAsBinaryString(b)}function _(b){b===o&&(b=bb.strings.genericWebGLError),fa.errorMsg.innerHTML="<p>"+b+"</p>",Wa.load.style.display="none",fa.load.box.style.display="none",fa.errorMsg.style.display="table",sb=!0,eb=o,J.style.display="none",ab("error",b)}function K(c){var a=ea(c);W.style.left=a.x+"px",W.style.top=a.y+"px",clearTimeout(K.t1),clearTimeout(K.t2),W.style.display="block",W.style.opacity=1,K.t1=setTimeout(function(){W.style.opacity=0},2E3),K.t2=setTimeout(function(){W.style.display="none"},2500),c.preventDefault()}function ea(c){var a=g.getBoundingClientRect(),b={};return b.x=(c.clientX||c.pageX)-a.left,b.y=(c.clientY||c.pageY)-a.top,b}function Q(b){if(b.preventDefault(),g.focus(),eb&&bb.draggable){var a=ea(b);if(bb.hotSpotDebug){var c=ka(b);console.log("Pitch: "+c[0]+", Yaw: "+c[1]+", Center Pitch: "+bb.pitch+", Center Yaw: "+bb.yaw+", HFOV: "+bb.hfov)}d(),_a(),bb.roll=0,ub.hfov=0,da=!0,lb=Date.now(),mb=a.x,nb=a.y,pb=bb.yaw,qb=bb.pitch,Va.classList.add("pnlm-grabbing"),Va.classList.remove("pnlm-grab"),ab("mousedown",b),Ba()}}function ja(b){bb.minHfov===bb.hfov?kb.setHfov(ib,1E3):(b=ka(b),kb.lookAt(b[0],b[1],bb.minHfov,1E3))}function ka(b){var i=ea(b);b=cb.getCanvas();var j=b.clientWidth,k=b.clientHeight;b=2*(i.x/j)-1;var k=(1-2*(i.y/k))*k/j,l=1/q(bb.hfov*z/360),e=v(bb.pitch*z/180),d=u(bb.pitch*z/180),i=l*d-k*e,j=B(b*b+i*i),k=180*h((k*d+l*e)/j)/z;return b=180*A(b/j,i/j)/z+bb.yaw,-180>b&&(b+=360),180<b&&(b-=360),[k,b]}function oa(b){if(da&&eb){lb=Date.now();var d=cb.getCanvas(),e=d.clientWidth,d=d.clientHeight;b=ea(b);var g=180*(h(2*(mb/e)-1)-h(2*(b.x/e)-1))/z*bb.hfov/90+pb;ub.yaw=.2*((g-bb.yaw)%360),bb.yaw=g,e=360*h(q(bb.hfov/360*z)*d/e)/z,e=180*(h(2*(b.y/d)-1)-h(2*(nb/d)-1))/z*e/90+qb,ub.pitch=.2*(e-bb.pitch),bb.pitch=e}}function pa(b){da&&(da=!1,15<Date.now()-lb&&(ub.pitch=ub.yaw=0),Va.classList.add("pnlm-grab"),Va.classList.remove("pnlm-grabbing"),lb=Date.now(),ab("mouseup",b))}function ma(b){if(eb&&bb.draggable){d(),_a(),bb.roll=0,ub.hfov=0;var a=ea(b.targetTouches[0]);if(mb=a.x,nb=a.y,2==b.targetTouches.length){var c=ea(b.targetTouches[1]);mb+=.5*(c.x-a.x),nb+=.5*(c.y-a.y),ob=B((a.x-c.x)*(a.x-c.x)+(a.y-c.y)*(a.y-c.y))}da=!0,lb=Date.now(),pb=bb.yaw,qb=bb.pitch,ab("touchstart",b),Ba()}}function qa(b){if(bb.draggable&&(b.preventDefault(),eb&&(lb=Date.now()),da&&eb)){var d=ea(b.targetTouches[0]),e=d.x,g=d.y;2==b.targetTouches.length&&-1!=ob&&(b=ea(b.targetTouches[1]),e+=.5*(b.x-d.x),g+=.5*(b.y-d.y),d=B((d.x-b.x)*(d.x-b.x)+(d.y-b.y)*(d.y-b.y)),La(bb.hfov+.1*(ob-d)),ob=d),d=bb.hfov/360*bb.touchPanSpeedCoeffFactor,e=(mb-e)*d+pb,ub.yaw=.2*((e-bb.yaw)%360),bb.yaw=e,g=(g-nb)*d+qb,ub.pitch=.2*(g-bb.pitch),bb.pitch=g}}function la(){da=!1,150<Date.now()-lb&&(ub.pitch=ub.yaw=0),ob=-1,lb=Date.now(),ab("touchend",event)}function ta(b){"touch"==b.pointerType&&eb&&bb.draggable&&(Ia.push(b.pointerId),Jb.push({clientX:b.clientX,clientY:b.clientY}),b.targetTouches=Jb,ma(b),b.preventDefault())}function ua(b){if("touch"==b.pointerType&&bb.draggable)for(var a=0;a<Ia.length;a++)if(b.pointerId==Ia[a]){Jb[a].clientX=b.clientX,Jb[a].clientY=b.clientY,b.targetTouches=Jb,qa(b),b.preventDefault();break}}function c(c){if("touch"==c.pointerType){for(var a=!1,d=0;d<Ia.length;d++)c.pointerId==Ia[d]&&(Ia[d]=o),Ia[d]&&(a=!0);a||(Ia=[],Jb=[],la()),c.preventDefault()}}function a(b){eb&&("fullscreenonly"!=bb.mouseZoom||r)&&(b.preventDefault(),d(),lb=Date.now(),b.wheelDeltaY?(La(bb.hfov-.05*b.wheelDeltaY),ub.hfov=0>b.wheelDelta?1:-1):b.wheelDelta?(La(bb.hfov-.05*b.wheelDelta),ub.hfov=0>b.wheelDelta?1:-1):b.detail&&(La(bb.hfov+1.5*b.detail),ub.hfov=0<b.detail?1:-1),Ba())}function U(b){d(),lb=Date.now(),_a(),bb.roll=0;var a=b.which||b.keycode;0>bb.capturedKeyNumbers.indexOf(a)||(b.preventDefault(),27==a?r&&l():R(a,!0))}function V(){for(var b=0;10>b;b++)rb[b]=!1}function $(b){var a=b.which||b.keycode;0>bb.capturedKeyNumbers.indexOf(a)||(b.preventDefault(),R(a,!1))}function R(c,a){var b=!1;109===c||189===c||17===c||173===c?(rb[0]!=a&&(b=!0),rb[0]=a):107===c||187===c||16===c||61===c?(rb[1]!=a&&(b=!0),rb[1]=a):38===c?(rb[2]!=a&&(b=!0),rb[2]=a):87===c?(rb[6]!=a&&(b=!0),rb[6]=a):40===c?(rb[3]!=a&&(b=!0),rb[3]=a):83===c?(rb[7]!=a&&(b=!0),rb[7]=a):37===c?(rb[4]!=a&&(b=!0),rb[4]=a):65===c?(rb[8]!=a&&(b=!0),rb[8]=a):39===c?(rb[5]!=a&&(b=!0),rb[5]=a):68===c?(rb[9]!=a&&(b=!0),rb[9]=a):void 0;b&&a&&(gb="undefined"!=typeof performance&&performance.now()?performance.now():Date.now(),Ba())}function wa(){if(eb){var b,h=!1,i=bb.pitch,j=bb.yaw,k=bb.hfov;b="undefined"!=typeof performance&&performance.now()?performance.now():Date.now(),gb===o&&(gb=b);var l=(b-gb)*bb.hfov/1700,l=s(l,1);if(rb[0]&&!0===bb.keyboardZoom&&(La(bb.hfov+(.8*ub.hfov+.5)*l),h=!0),rb[1]&&!0===bb.keyboardZoom&&(La(bb.hfov+(.8*ub.hfov-.2)*l),h=!0),(rb[2]||rb[6])&&(bb.pitch+=(.8*ub.pitch+.2)*l,h=!0),(rb[3]||rb[7])&&(bb.pitch+=(.8*ub.pitch-.2)*l,h=!0),(rb[4]||rb[8])&&(bb.yaw+=(.8*ub.yaw-.2)*l,h=!0),(rb[5]||rb[9])&&(bb.yaw+=(.8*ub.yaw+.2)*l,h=!0),h&&(lb=Date.now()),bb.autoRotate){if(.001<b-gb){var h=(b-gb)/1E3,m=(ub.yaw/h*l-.2*bb.autoRotate)*h,m=(0<-bb.autoRotate?1:-1)*s(y(bb.autoRotate*h),y(m));bb.yaw+=m}bb.autoRotateStopDelay&&(bb.autoRotateStopDelay-=b-gb,0>=bb.autoRotateStopDelay&&(bb.autoRotateStopDelay=!1,yb=bb.autoRotate,bb.autoRotate=0))}zb.pitch&&(ga("pitch"),i=bb.pitch),zb.yaw&&(ga("yaw"),j=bb.yaw),zb.hfov&&(ga("hfov"),k=bb.hfov),0<l&&!bb.autoRotate&&(h=1-bb.friction,rb[4]||rb[5]||rb[8]||rb[9]||zb.yaw||(bb.yaw+=ub.yaw*l*h),rb[2]||rb[3]||rb[6]||rb[7]||zb.pitch||(bb.pitch+=ub.pitch*l*h),rb[0]||rb[1]||zb.hfov||La(bb.hfov+ub.hfov*l*h)),gb=b,0<l&&(ub.yaw=.8*ub.yaw+.2*((bb.yaw-j)/l),ub.pitch=.8*ub.pitch+.2*((bb.pitch-i)/l),ub.hfov=.8*ub.hfov+.2*((bb.hfov-k)/l),i=bb.autoRotate?y(bb.autoRotate):5,ub.yaw=s(i,t(ub.yaw,-i)),ub.pitch=s(i,t(ub.pitch,-i)),ub.hfov=s(i,t(ub.hfov,-i))),rb[0]&&rb[1]&&(ub.hfov=0),(rb[2]||rb[6])&&(rb[3]||rb[7])&&(ub.pitch=0),(rb[4]||rb[8])&&(rb[5]||rb[9])&&(ub.yaw=0)}}function ga(b){var a=zb[b],c=s(1,t((Date.now()-a.startTime)/1E3/(a.duration/1E3),0)),c=a.startPosition+bb.animationTimingFunction(c)*(a.endPosition-a.startPosition);(a.endPosition>a.startPosition&&c>=a.endPosition||a.endPosition<a.startPosition&&c<=a.endPosition||a.endPosition===a.startPosition)&&(c=a.endPosition,ub[b]=0,delete zb[b]),bb[b]=c}function m(){Ca("resize")}function Ba(){vb||(vb=!0,F())}function F(){if(!Eb)if(ca(),hb&&clearTimeout(hb),da||!0===wb)requestAnimationFrame(F);else if(rb[0]||rb[1]||rb[2]||rb[3]||rb[4]||rb[5]||rb[6]||rb[7]||rb[8]||rb[9]||bb.autoRotate||zb.pitch||zb.yaw||zb.hfov||.01<y(ub.yaw)||.01<y(ub.pitch)||.01<y(ub.hfov))wa(),0<=bb.autoRotateInactivityDelay&&yb&&Date.now()-lb>bb.autoRotateInactivityDelay&&!bb.autoRotate&&(bb.autoRotate=yb,kb.lookAt(jb,o,ib,3E3)),requestAnimationFrame(F);else if(cb&&(cb.isLoading()||!0===bb.dynamic&&Cb))requestAnimationFrame(F);else{ab("animatefinished",{pitch:kb.getPitch(),yaw:kb.getYaw(),hfov:kb.getHfov()}),vb=!1,gb=o;var b=bb.autoRotateInactivityDelay-(Date.now()-lb);0<b?hb=setTimeout(function(){bb.autoRotate=yb,kb.lookAt(jb,o,ib,3E3),Ba()},b):0<=bb.autoRotateInactivityDelay&&yb&&(bb.autoRotate=yb,kb.lookAt(jb,o,ib,3E3),Ba())}}function ca(){var b;if(eb){var g=cb.getCanvas();!1!==bb.autoRotate&&(360<bb.yaw?bb.yaw-=360:-360>bb.yaw&&(bb.yaw+=360)),b=bb.yaw;var i=0;if(bb.avoidShowingBackground){var j=bb.hfov/2,k=180*A(q(j/180*z),g.width/g.height)/z;bb.vaov>bb.haov?s(u((bb.pitch-j)/180*z),u((bb.pitch+j)/180*z)):i=j*(1-s(u((bb.pitch-k)/180*z),u((bb.pitch+k)/180*z)))}var j=bb.maxYaw-bb.minYaw,k=-180,l=180;360>j&&(k=bb.minYaw+bb.hfov/2+i,l=bb.maxYaw-bb.hfov/2-i,j<bb.hfov&&(k=l=(k+l)/2),bb.yaw=t(k,s(l,bb.yaw))),!1===bb.autoRotate&&(360<bb.yaw?bb.yaw-=360:-360>bb.yaw&&(bb.yaw+=360)),!1!==bb.autoRotate&&b!=bb.yaw&&gb!==o&&(bb.autoRotate*=-1),b=180*(2*h(q(.5*(bb.hfov/180*z))/(g.width/g.height))/z),g=bb.minPitch+b/2,i=bb.maxPitch-b/2,bb.maxPitch-bb.minPitch<b&&(g=i=(g+i)/2),isNaN(g)&&(g=-90),isNaN(i)&&(i=90),bb.pitch=t(g,s(i,bb.pitch)),cb.render(bb.pitch*z/180,bb.yaw*z/180,bb.hfov*z/180,{roll:bb.roll*z/180}),bb.hotSpots.forEach(Ja),bb.compass&&(Ib.style.transform="rotate("+(-bb.yaw-bb.northOffset)+"deg)",Ib.style.webkitTransform="rotate("+(-bb.yaw-bb.northOffset)+"deg)")}}function Ea(e,a,b,c){this.w=e,this.x=a,this.y=b,this.z=c}function Y(b){var d=b.alpha;var e=b.beta;b=b.gamma,e=[e?e*z/180/2:0,b?b*z/180/2:0,d?d*z/180/2:0],d=[u(e[0]),u(e[1]),u(e[2])],e=[v(e[0]),v(e[1]),v(e[2])],d=new Ea(d[0]*d[1]*d[2]-e[0]*e[1]*e[2],e[0]*d[1]*d[2]-d[0]*e[1]*e[2],d[0]*e[1]*d[2]+e[0]*d[1]*e[2],d[0]*d[1]*e[2]+e[0]*e[1]*d[2]),d=d.multiply(new Ea(B(.5),-B(.5),0,0)),e=i.orientation?-i.orientation*z/180/2:0,d=d.multiply(new Ea(u(e),0,-v(e),0)).toEulerAngles(),"number"==typeof wb&&10>wb?wb+=1:10===wb?(xb=180*(d[2]/z)+bb.yaw,wb=!0,requestAnimationFrame(F)):(bb.pitch=180*(d[0]/z),bb.roll=180*(-d[1]/z),bb.yaw=180*(-d[2]/z)+xb)}function na(){try{var b={};bb.horizonPitch!==o&&(b.horizonPitch=bb.horizonPitch*z/180),bb.horizonRoll!==o&&(b.horizonRoll=bb.horizonRoll*z/180),bb.backgroundColor!==o&&(b.backgroundColor=bb.backgroundColor),cb.init(fb,bb.type,bb.dynamic,bb.haov*z/180,bb.vaov*z/180,bb.vOffset*z/180,va,b),!0!==bb.dynamic&&(fb=o)}catch(a){if("webgl error"==a.type||"no webgl"==a.type)_();else if("webgl size error"==a.type)_(bb.strings.textureSizeError.replace("%s",a.width).replace("%s",a.maxWidth));else throw _(bb.strings.unknownError),a}}function va(){if(bb.sceneFadeDuration&&cb.fadeImg!==o){cb.fadeImg.style.opacity=0;var b=cb.fadeImg;delete cb.fadeImg,setTimeout(function(){J.removeChild(b),ab("scenechangefadedone")},bb.sceneFadeDuration)}Ib.style.display=bb.compass?"inline":"none",Fa(),fa.load.box.style.display="none",db!==o&&(J.removeChild(db),db=o),eb=!0,ab("load"),Ba()}function S(g){g.pitch=+g.pitch||0,g.yaw=+g.yaw||0;var a=j.createElement("div");a.className="pnlm-hotspot-base",a.className=g.cssClass?a.className+(" "+g.cssClass):a.className+(" pnlm-hotspot pnlm-sprite pnlm-"+Ra(g.type));var b=j.createElement("span");g.text&&(b.innerHTML=Ra(g.text));var c;if(g.video){c=j.createElement("video");var f=g.video;bb.basePath&&!k(f)&&(f=bb.basePath+f),c.src=D(f),c.controls=!0,c.style.width=g.width+"px",J.appendChild(a),b.appendChild(c)}else if(g.image){f=g.image,bb.basePath&&!k(f)&&(f=bb.basePath+f),c=j.createElement("a"),c.href=D(g.URL?g.URL:f,!0),c.target="_blank",b.appendChild(c);var i=j.createElement("img");i.src=D(f),i.style.width=g.width+"px",i.style.paddingTop="5px",J.appendChild(a),c.appendChild(i),b.style.maxWidth="initial"}else if(g.URL){if(c=j.createElement("a"),c.href=D(g.URL,!0),g.attributes)for(f in g.attributes)c.setAttribute(f,g.attributes[f]);else c.target="_blank";J.appendChild(c),a.className+=" pnlm-pointer",b.className+=" pnlm-pointer",c.appendChild(a)}else g.sceneId&&(a.onclick=a.ontouchend=function(){return a.clicked||(a.clicked=!0,Ya(g.sceneId,g.targetPitch,g.targetYaw,g.targetHfov)),!1},a.className+=" pnlm-pointer",b.className+=" pnlm-pointer"),J.appendChild(a);g.createTooltipFunc?g.createTooltipFunc(a,g.createTooltipArgs):(g.text||g.video||g.image)&&(a.classList.add("pnlm-tooltip"),a.appendChild(b),b.style.width=b.scrollWidth-20+"px",b.style.marginLeft=-(b.scrollWidth-a.offsetWidth)/2+"px",b.style.marginTop=-b.scrollHeight-12+"px"),g.clickHandlerFunc&&(a.addEventListener("click",function(a){g.clickHandlerFunc(a,g.clickHandlerArgs)},"false"),a.className+=" pnlm-pointer",b.className+=" pnlm-pointer"),g.div=a}function Fa(){Db||(bb.hotSpots?(bb.hotSpots=bb.hotSpots.sort(function(c,a){return c.pitch<a.pitch}),bb.hotSpots.forEach(S)):bb.hotSpots=[],Db=!0,bb.hotSpots.forEach(Ja))}function L(){var b=bb.hotSpots;if(Db=!1,delete bb.hotSpots,b)for(var a,d=0;d<b.length;d++){if(a=b[d].div,a){for(;a.parentNode&&a.parentNode!=J;)a=a.parentNode;J.removeChild(a)}delete b[d].div}}function Ja(b){var a=v(b.pitch*z/180),i=u(b.pitch*z/180),j=v(bb.pitch*z/180),n=u(bb.pitch*z/180),e=u((-b.yaw+bb.yaw)*z/180),g=a*j+i*e*n;if(90>=b.yaw&&-90<b.yaw&&0>=g||(90<b.yaw||-90>=b.yaw)&&0>=g)b.div.style.visibility="hidden";else{var h=v((-b.yaw+bb.yaw)*z/180),l=q(bb.hfov*z/360);b.div.style.visibility="visible";var k=cb.getCanvas(),o=k.clientWidth,k=k.clientHeight,a=[-o/l*h*i/g/2,-o/l*(a*n-i*e*j)/g/2],i=v(bb.roll*z/180),j=u(bb.roll*z/180),a=[a[0]*j-a[1]*i,a[0]*i+a[1]*j];a[0]+=(o-b.div.offsetWidth)/2,a[1]+=(k-b.div.offsetHeight)/2,o="translate("+a[0]+"px, "+a[1]+"px) translateZ(9999px) rotate("+bb.roll+"deg)",b.scale&&(o+=" scale("+ib/bb.hfov/g+")"),b.div.style.webkitTransform=o,b.div.style.MozTransform=o,b.div.style.transform=o}}function e(b){bb={};var a,g,h=["haov","vaov","vOffset","northOffset","horizonPitch","horizonRoll"];for(a in Bb=[],Fb)Fb.hasOwnProperty(a)&&(bb[a]=Fb[a]);for(a in n.default)if(n.default.hasOwnProperty(a))if("strings"==a)for(g in n.default.strings)n.default.strings.hasOwnProperty(g)&&(bb.strings[g]=Ra(n.default.strings[g]));else bb[a]=n.default[a],0<=h.indexOf(a)&&Bb.push(a);if(null!==b&&""!==b&&n.scenes&&n.scenes[b]){var d=n.scenes[b];for(a in d)if(d.hasOwnProperty(a))if("strings"==a)for(g in d.strings)d.strings.hasOwnProperty(g)&&(bb.strings[g]=Ra(d.strings[g]));else bb[a]=d[a],0<=h.indexOf(a)&&Bb.push(a);bb.scene=b}for(a in n)if(n.hasOwnProperty(a))if("strings"==a)for(g in n.strings)n.strings.hasOwnProperty(g)&&(bb.strings[g]=Ra(n.strings[g]));else bb[a]=n[a],0<=h.indexOf(a)&&Bb.push(a)}function H(b){if((b=!!b&&b)&&"preview"in bb){var g=bb.preview;bb.basePath&&!k(g)&&(g=bb.basePath+g),db=j.createElement("div"),db.className="pnlm-preview-img",db.style.backgroundImage="url('"+D(g).replace(/"/g,"%22").replace(/'/g,"%27")+"')",J.appendChild(db)}var g=bb.title,i=bb.author;for(var d in b&&("previewTitle"in bb&&(bb.title=bb.previewTitle),"previewAuthor"in bb&&(bb.author=bb.previewAuthor)),bb.hasOwnProperty("title")||(fa.title.innerHTML=""),bb.hasOwnProperty("author")||(fa.author.innerHTML=""),bb.hasOwnProperty("title")||bb.hasOwnProperty("author")||(fa.container.style.display="none"),Wa.load.innerHTML="<p>"+bb.strings.loadButtonLabel+"</p>",fa.load.boxp.innerHTML=bb.strings.loadingLabel,bb)if(bb.hasOwnProperty(d))switch(d){case"title":fa.title.innerHTML=Ra(bb[d]),fa.container.style.display="inline";break;case"author":var e=Ra(bb[d]);bb.authorURL&&(e=j.createElement("a"),e.href=D(bb.authorURL,!0),e.target="_blank",e.innerHTML=Ra(bb[d]),e=e.outerHTML),fa.author.innerHTML=bb.strings.bylineLabel.replace("%s",e),fa.container.style.display="inline";break;case"fallback":e=j.createElement("a"),e.href=D(bb[d],!0),e.target="_blank",e.textContent="Click here to view this panorama in an alternative viewer.";var l=j.createElement("p");l.textContent="Your browser does not support WebGL.",l.appendChild(j.createElement("br")),l.appendChild(e),fa.errorMsg.innerHTML="",fa.errorMsg.appendChild(l);break;case"hfov":La(+bb[d]);break;case"autoLoad":!0===bb[d]&&cb===o&&(fa.load.box.style.display="inline",Wa.load.style.display="none",f());break;case"showZoomCtrl":Wa.zoom.style.display=bb[d]&&!1!=bb.showControls?"block":"none";break;case"showFullscreenCtrl":Wa.fullscreen.style.display=bb[d]&&!1!=bb.showControls&&("fullscreen"in j||"mozFullScreen"in j||"webkitIsFullScreen"in j||"msFullscreenElement"in j)?"block":"none";break;case"hotSpotDebug":Gb.style.display=bb[d]?"block":"none";break;case"showControls":bb[d]||(Wa.orientation.style.display="none",Wa.zoom.style.display="none",Wa.fullscreen.style.display="none");break;case"orientationOnByDefault":bb[d]&&Da();}b&&(g?bb.title=g:delete bb.title,i?bb.author=i:delete bb.author)}function l(){if(eb&&!sb)if(r)j.exitFullscreen?j.exitFullscreen():j.mozCancelFullScreen?j.mozCancelFullScreen():j.webkitCancelFullScreen?j.webkitCancelFullScreen():j.msExitFullscreen&&j.msExitFullscreen();else try{g.requestFullscreen?g.requestFullscreen():g.mozRequestFullScreen?g.mozRequestFullScreen():g.msRequestFullscreen?g.msRequestFullscreen():g.webkitRequestFullScreen()}catch(b){}}function Ca(b){j.fullscreenElement||j.fullscreen||j.mozFullScreen||j.webkitIsFullScreen||j.msFullscreenElement?(Wa.fullscreen.classList.add("pnlm-fullscreen-toggle-button-active"),r=!0):(Wa.fullscreen.classList.remove("pnlm-fullscreen-toggle-button-active"),r=!1),"resize"!==b&&ab("fullscreenchange",r),cb.resize(),La(bb.hfov),Ba()}function Ka(b){var e=bb.minHfov;if("multires"==bb.type&&cb&&!bb.multiResMinHfov&&(e=s(e,cb.getCanvas().width/(.9*(bb.multiRes.cubeResolution/90)))),e>bb.maxHfov)return console.log("HFOV bounds do not make sense (minHfov > maxHfov)."),bb.hfov;var f=bb.hfov,f=b<e?e:b>bb.maxHfov?bb.maxHfov:b;return bb.avoidShowingBackground&&cb&&(b=cb.getCanvas(),f=s(f,360*h(q((bb.maxPitch-bb.minPitch)/360*z)/b.height*b.width)/z)),f}function La(b){bb.hfov=Ka(b),ab("zoomchange",bb.hfov)}function d(){zb={},yb=bb.autoRotate?bb.autoRotate:yb,bb.autoRotate=!1}function x(){sb&&(fa.load.box.style.display="none",fa.errorMsg.style.display="none",sb=!1,J.style.display="block",ab("errorcleared")),eb=!1,Wa.load.style.display="none",fa.load.box.style.display="inline",f()}function Ya(b,a,c,d,f){eb||(f=!0),eb=!1,zb={};var h,i;return bb.sceneFadeDuration&&!f&&(h=cb.render(bb.pitch*z/180,bb.yaw*z/180,bb.hfov*z/180,{returnImage:!0}),h!==o)?(f=new Image,f.className="pnlm-fade-img",f.style.transition="opacity "+bb.sceneFadeDuration/1E3+"s",f.style.width="100%",f.style.height="100%",f.onload=function(){Ya(b,a,c,d,!0)},f.src=h,J.appendChild(f),void(cb.fadeImg=f)):void(f="same"===a?bb.pitch:a,h="same"===c?bb.yaw:"sameAzimuth"===c?bb.yaw+(bb.northOffset||0)-(n.scenes[b].northOffset||0):c,i="same"===d?bb.hfov:d,L(),e(b),ub.yaw=ub.pitch=ub.hfov=0,H(),f!==o&&(bb.pitch=f),h!==o&&(bb.yaw=h),i!==o&&(bb.hfov=i),ab("scenechange",b),x())}function _a(){i.removeEventListener("deviceorientation",Y),Wa.orientation.classList.remove("pnlm-orientation-button-active"),wb=!1}function Da(){"function"==typeof DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(function(b){"granted"==b&&(wb=1,i.addEventListener("deviceorientation",Y),Wa.orientation.classList.add("pnlm-orientation-button-active"))}):(wb=1,i.addEventListener("deviceorientation",Y),Wa.orientation.classList.add("pnlm-orientation-button-active"))}function Ra(b){return n.escapeHTML?(b+"").split(/&/g).join("&amp;").split("\"").join("&quot;").split("'").join("&#39;").split("<").join("&lt;").split(">").join("&gt;").split("/").join("&#x2f;").split("\n").join("<br>"):(b+"").split("\n").join("<br>")}function D(d,a){try{var b=decodeURIComponent(I(d)).replace(/[^\w:]/g,"").toLowerCase()}catch(a){return"about:blank"}return 0===b.indexOf("javascript:")||0===b.indexOf("vbscript:")?(console.log("Script URL removed."),"about:blank"):a&&0===b.indexOf("data:")?(console.log("Data URI removed from link."),"about:blank"):d}function I(b){return b.replace(/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,function(c,a){var d=String.fromCharCode;return a=a.toLowerCase(),"colon"===a?":":"#"===a.charAt(0)?"x"===a.charAt(1)?d(parseInt(a.substring(2),16)):d(+a.substring(1)):""})}function ab(c){if(c in Ab)for(var a=Ab[c].length;0<a;a--)Ab[c][Ab[c].length-a].apply(null,[].slice.call(arguments,1))}var bb,cb,db,eb,fb,gb,hb,ib,jb,kb=this,da=!1,lb=Date.now(),mb=0,nb=0,ob=-1,pb=0,qb=0,rb=Array(10),r=!1,sb=!1,tb=!1,ub={yaw:0,pitch:0,hfov:0},vb=!1,wb=!1,xb=0,yb=0,zb={},Ab={},Bb=[],Cb=!1,Db=!1,Eb=!1,Fb={hfov:100,minHfov:50,multiResMinHfov:!1,maxHfov:120,pitch:0,minPitch:o,maxPitch:o,yaw:0,minYaw:-180,maxYaw:180,roll:0,haov:360,vaov:180,vOffset:0,autoRotate:!1,autoRotateInactivityDelay:-1,autoRotateStopDelay:o,type:"equirectangular",northOffset:0,showFullscreenCtrl:!0,dynamic:!1,dynamicUpdate:!1,doubleClickZoom:!0,keyboardZoom:!0,mouseZoom:!0,showZoomCtrl:!0,autoLoad:!1,showControls:!0,orientationOnByDefault:!1,hotSpotDebug:!1,backgroundColor:[0,0,0],avoidShowingBackground:!1,animationTimingFunction:function(b){return .5>b?2*b*b:-1+(4-2*b)*b},draggable:!0,disableKeyboardCtrl:!1,crossOrigin:"anonymous",touchPanSpeedCoeffFactor:1,capturedKeyNumbers:[16,17,27,37,38,39,40,61,65,68,83,87,107,109,173,187,189],friction:.15,strings:{loadButtonLabel:"Click to<br>Load<br>Panorama",loadingLabel:"Loading...",bylineLabel:"by %s",noPanoramaError:"No panorama image was specified.",fileAccessError:"The file %s could not be accessed.",malformedURLError:"There is something wrong with the panorama URL.",iOS8WebGLError:"Due to iOS 8's broken WebGL implementation, only progressive encoded JPEGs work for your device (this panorama uses standard encoding).",genericWebGLError:"Your browser does not have the necessary WebGL support to display this panorama.",textureSizeError:"This panorama is too big for your device! It's %spx wide, but your device only supports images up to %spx wide. Try another device. (If you're the author, try scaling down the image.)",unknownError:"Unknown error. Check developer console."}};g="string"==typeof g?j.getElementById(g):g,g.classList.add("pnlm-container"),g.tabIndex=0;var Va=j.createElement("div");Va.className="pnlm-ui",g.appendChild(Va);var J=j.createElement("div");J.className="pnlm-render-container",g.appendChild(J);var M=j.createElement("div");M.className="pnlm-dragfix",Va.appendChild(M);var W=j.createElement("span");W.className="pnlm-about-msg",W.innerHTML="<a href=\"https://pannellum.org/\" target=\"_blank\">Pannellum</a> 2.5.6",Va.appendChild(W),M.addEventListener("contextmenu",K);var fa={},Gb=j.createElement("div");Gb.className="pnlm-sprite pnlm-hot-spot-debug-indicator",Va.appendChild(Gb),fa.container=j.createElement("div"),fa.container.className="pnlm-panorama-info",fa.title=j.createElement("div"),fa.title.className="pnlm-title-box",fa.container.appendChild(fa.title),fa.author=j.createElement("div"),fa.author.className="pnlm-author-box",fa.container.appendChild(fa.author),Va.appendChild(fa.container),fa.load={},fa.load.box=j.createElement("div"),fa.load.box.className="pnlm-load-box",fa.load.boxp=j.createElement("p"),fa.load.box.appendChild(fa.load.boxp),fa.load.lbox=j.createElement("div"),fa.load.lbox.className="pnlm-lbox",fa.load.lbox.innerHTML="<div class=\"pnlm-loading\"></div>",fa.load.box.appendChild(fa.load.lbox),fa.load.lbar=j.createElement("div"),fa.load.lbar.className="pnlm-lbar",fa.load.lbarFill=j.createElement("div"),fa.load.lbarFill.className="pnlm-lbar-fill",fa.load.lbar.appendChild(fa.load.lbarFill),fa.load.box.appendChild(fa.load.lbar),fa.load.msg=j.createElement("p"),fa.load.msg.className="pnlm-lmsg",fa.load.box.appendChild(fa.load.msg),Va.appendChild(fa.load.box),fa.errorMsg=j.createElement("div"),fa.errorMsg.className="pnlm-error-msg pnlm-info-box",Va.appendChild(fa.errorMsg);var Wa={};Wa.container=j.createElement("div"),Wa.container.className="pnlm-controls-container",Va.appendChild(Wa.container),Wa.load=j.createElement("div"),Wa.load.className="pnlm-load-button",Wa.load.addEventListener("click",function(){H(),x()}),Va.appendChild(Wa.load),Wa.zoom=j.createElement("div"),Wa.zoom.className="pnlm-zoom-controls pnlm-controls",Wa.zoomIn=j.createElement("div"),Wa.zoomIn.className="pnlm-zoom-in pnlm-sprite pnlm-control",Wa.zoomIn.addEventListener("click",function(){eb&&(La(bb.hfov-5),Ba())}),Wa.zoom.appendChild(Wa.zoomIn),Wa.zoomOut=j.createElement("div"),Wa.zoomOut.className="pnlm-zoom-out pnlm-sprite pnlm-control",Wa.zoomOut.addEventListener("click",function(){eb&&(La(bb.hfov+5),Ba())}),Wa.zoom.appendChild(Wa.zoomOut),Wa.container.appendChild(Wa.zoom),Wa.fullscreen=j.createElement("div"),Wa.fullscreen.addEventListener("click",l),Wa.fullscreen.className="pnlm-fullscreen-toggle-button pnlm-sprite pnlm-fullscreen-toggle-button-inactive pnlm-controls pnlm-control",(j.fullscreenEnabled||j.mozFullScreenEnabled||j.webkitFullscreenEnabled||j.msFullscreenEnabled)&&Wa.container.appendChild(Wa.fullscreen),Wa.orientation=j.createElement("div"),Wa.orientation.addEventListener("click",function(){wb?_a():Da()}),Wa.orientation.addEventListener("mousedown",function(b){b.stopPropagation()}),Wa.orientation.addEventListener("touchstart",function(b){b.stopPropagation()}),Wa.orientation.addEventListener("pointerdown",function(b){b.stopPropagation()}),Wa.orientation.className="pnlm-orientation-button pnlm-orientation-button-inactive pnlm-sprite pnlm-controls pnlm-control";var Hb=!1;i.DeviceOrientationEvent&&"https:"==location.protocol&&0<=navigator.userAgent.toLowerCase().indexOf("mobi")&&(Wa.container.appendChild(Wa.orientation),Hb=!0);var Ib=j.createElement("div");Ib.className="pnlm-compass pnlm-controls pnlm-control",Va.appendChild(Ib),n.firstScene?e(n.firstScene):n.default&&n.default.firstScene?e(n.default.firstScene):e(null),H(!0);var Ia=[],Jb=[];Ea.prototype.multiply=function(b){return new Ea(this.w*b.w-this.x*b.x-this.y*b.y-this.z*b.z,this.x*b.w+this.w*b.x+this.y*b.z-this.z*b.y,this.y*b.w+this.w*b.y+this.z*b.x-this.x*b.z,this.z*b.w+this.w*b.z+this.x*b.y-this.y*b.x)},Ea.prototype.toEulerAngles=function(){var d=A(2*(this.w*this.x+this.y*this.z),1-2*(this.x*this.x+this.y*this.y)),a=Math.asin(2*(this.w*this.y-this.z*this.x)),b=A(2*(this.w*this.z+this.x*this.y),1-2*(this.y*this.y+this.z*this.z));return[d,a,b]},this.isLoaded=function(){return!!eb},this.getPitch=function(){return bb.pitch},this.setPitch=function(b,a,f,d){return(lb=Date.now(),1E-6>=y(b-bb.pitch))?("function"==typeof f&&f(d),this):((a=a==o?1E3:+a)?(zb.pitch={startTime:Date.now(),startPosition:bb.pitch,endPosition:b,duration:a},"function"==typeof f&&setTimeout(function(){f(d)},a)):bb.pitch=b,Ba(),this)},this.getPitchBounds=function(){return[bb.minPitch,bb.maxPitch]},this.setPitchBounds=function(b){return bb.minPitch=t(-90,s(b[0],90)),bb.maxPitch=t(-90,s(b[1],90)),this},this.getYaw=function(){return(bb.yaw+540)%360-180},this.setYaw=function(b,f,g,d){return(lb=Date.now(),1E-6>=y(b-bb.yaw))?("function"==typeof g&&g(d),this):(f=f==o?1E3:+f,b=(b+180)%360-180,f?(180<bb.yaw-b?b+=360:180<b-bb.yaw&&(b-=360),zb.yaw={startTime:Date.now(),startPosition:bb.yaw,endPosition:b,duration:f},"function"==typeof g&&setTimeout(function(){g(d)},f)):bb.yaw=b,Ba(),this)},this.getYawBounds=function(){return[bb.minYaw,bb.maxYaw]},this.setYawBounds=function(b){return bb.minYaw=t(-360,s(b[0],360)),bb.maxYaw=t(-360,s(b[1],360)),this},this.getHfov=function(){return bb.hfov},this.setHfov=function(b,a,f,d){return(lb=Date.now(),1E-6>=y(b-bb.hfov))?("function"==typeof f&&f(d),this):((a=a==o?1E3:+a)?(zb.hfov={startTime:Date.now(),startPosition:bb.hfov,endPosition:Ka(b),duration:a},"function"==typeof f&&setTimeout(function(){f(d)},a)):La(b),Ba(),this)},this.getHfovBounds=function(){return[bb.minHfov,bb.maxHfov]},this.setHfovBounds=function(b){return bb.minHfov=t(0,b[0]),bb.maxHfov=t(0,b[1]),this},this.lookAt=function(b,a,c,d,f,i){return d=d==o?1E3:+d,b!==o&&1E-6<y(b-bb.pitch)&&(this.setPitch(b,d,f,i),f=o),a!==o&&1E-6<y(a-bb.yaw)&&(this.setYaw(a,d,f,i),f=o),c!==o&&1E-6<y(c-bb.hfov)&&(this.setHfov(c,d,f,i),f=o),"function"==typeof f&&f(i),this},this.getNorthOffset=function(){return bb.northOffset},this.setNorthOffset=function(b){return bb.northOffset=s(360,t(0,b)),Ba(),this},this.getHorizonRoll=function(){return bb.horizonRoll},this.setHorizonRoll=function(b){return bb.horizonRoll=s(90,t(-90,b)),cb.setPose(bb.horizonPitch*z/180,bb.horizonRoll*z/180),Ba(),this},this.getHorizonPitch=function(){return bb.horizonPitch},this.setHorizonPitch=function(b){return bb.horizonPitch=s(90,t(-90,b)),cb.setPose(bb.horizonPitch*z/180,bb.horizonRoll*z/180),Ba(),this},this.startAutoRotate=function(b,d){return b=b||yb||1,d=d===o?jb:d,bb.autoRotate=b,kb.lookAt(d,o,ib,3E3),Ba(),this},this.stopAutoRotate=function(){return yb=bb.autoRotate?bb.autoRotate:yb,bb.autoRotate=!1,bb.autoRotateInactivityDelay=-1,this},this.stopMovement=function(){d(),ub={yaw:0,pitch:0,hfov:0}},this.getRenderer=function(){return cb},this.setUpdate=function(b){return Cb=!0===b,cb===o?p():Ba(),this},this.mouseEventToCoords=function(b){return ka(b)},this.loadScene=function(e,a,b,c){return!1!==eb&&Ya(e,a,b,c),this},this.getScene=function(){return bb.scene},this.addScene=function(c,a){return n.scenes[c]=a,this},this.removeScene=function(b){return!!(bb.scene!==b&&n.scenes.hasOwnProperty(b))&&(delete n.scenes[b],!0)},this.toggleFullscreen=function(){return l(),this},this.getConfig=function(){return bb},this.getContainer=function(){return g},this.addHotSpot=function(b,a){if(a===o&&bb.scene===o)bb.hotSpots.push(b);else{var c=a===o?bb.scene:a;if(n.scenes.hasOwnProperty(c))n.scenes[c].hasOwnProperty("hotSpots")||(n.scenes[c].hotSpots=[],c==bb.scene&&(bb.hotSpots=n.scenes[c].hotSpots)),n.scenes[c].hotSpots.push(b);else throw"Invalid scene ID!"}return(a===o||bb.scene==a)&&(S(b),eb&&Ja(b)),this},this.removeHotSpot=function(b,a){if(a===o||bb.scene==a){if(!bb.hotSpots)return!1;for(var c=0;c<bb.hotSpots.length;c++)if(bb.hotSpots[c].hasOwnProperty("id")&&bb.hotSpots[c].id===b){for(var f=bb.hotSpots[c].div;f.parentNode!=J;)f=f.parentNode;return J.removeChild(f),delete bb.hotSpots[c].div,bb.hotSpots.splice(c,1),!0}}else if(n.scenes.hasOwnProperty(a)){if(!n.scenes[a].hasOwnProperty("hotSpots"))return!1;for(c=0;c<n.scenes[a].hotSpots.length;c++)if(n.scenes[a].hotSpots[c].hasOwnProperty("id")&&n.scenes[a].hotSpots[c].id===b)return n.scenes[a].hotSpots.splice(c,1),!0}else return!1},this.resize=function(){cb&&m()},this.isLoaded=function(){return eb},this.isOrientationSupported=function(){return Hb||!1},this.stopOrientation=function(){_a()},this.startOrientation=function(){Hb&&Da()},this.isOrientationActive=function(){return!!wb},this.on=function(c,a){return Ab[c]=Ab[c]||[],Ab[c].push(a),this},this.off=function(d,a){if(!d)return Ab={},this;if(a){var b=Ab[d].indexOf(a);0<=b&&Ab[d].splice(b,1),0==Ab[d].length&&delete Ab[d]}else delete Ab[d];return this},this.destroy=function(){Eb=!0,clearTimeout(hb),cb&&cb.destroy(),tb&&(j.removeEventListener("mousemove",oa,!1),j.removeEventListener("mouseup",pa,!1),g.removeEventListener("mozfullscreenchange",Ca,!1),g.removeEventListener("webkitfullscreenchange",Ca,!1),g.removeEventListener("msfullscreenchange",Ca,!1),g.removeEventListener("fullscreenchange",Ca,!1),i.removeEventListener("resize",m,!1),i.removeEventListener("orientationchange",m,!1),g.removeEventListener("keydown",U,!1),g.removeEventListener("keyup",$,!1),g.removeEventListener("blur",V,!1),j.removeEventListener("mouseleave",pa,!1)),g.innerHTML="",g.classList.remove("pnlm-container")}}return{viewer:function(b,c){return new a(b,c)}}}(window,document);